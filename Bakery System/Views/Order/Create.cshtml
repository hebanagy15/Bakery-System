@model Bakery_System.Models.Order

@using Microsoft.AspNetCore.Mvc.Rendering

<h2>Create Order</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()


   

    <div>
        @Html.LabelFor(m => m.PaymentMethod)
        @Html.TextBoxFor(m => m.PaymentMethod)
    </div>

    <h4>Order Items</h4>
    <table id="itemsTable">
        <thead>
            <tr>
                <th>Bakery Item</th>
                <th>Quantity</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.OrderItems.Count; i++)
            {
                <tr>
                    <td>
                        @Html.DropDownList($"OrderItems[{i}].BakeryItemId", (SelectList)ViewBag.BakeryItems, "-- Select Item --")
                    </td>
                    <td>
                        @Html.TextBox($"OrderItems[{i}].Quantity", Model.OrderItems[i].Quantity, new { @type = "number", min = "1" })
                    </td>
                    <td>
                        <button type="button" onclick="removeRow(this)">❌</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <button type="button" onclick="addItem()">➕ Add Item</button>

    <br />
    <br />
    <input type="submit" value="Place Order" />
}

@section Scripts {
    <script>
        let itemIndex = @Model.OrderItems.Count;

        function addItem() {
            const row = `
                <tr>
                    <td>
                        <select name="OrderItems[${itemIndex}].BakeryItemId">
        @foreach (var item in (SelectList)ViewBag.BakeryItems)
        {
                                    <option value="@item.Value">@item.Text</option>
        }
                        </select>
                    </td>
                    <td>
                        <input name="OrderItems[${itemIndex}].Quantity" type="number" min="1" />
                    </td>
                    <td>
                        <button type="button" onclick="removeRow(this)">❌</button>
                    </td>
                </tr>`;
            document.querySelector("#itemsTable tbody").insertAdjacentHTML("beforeend", row);
            itemIndex++;
        }

        function removeRow(button) {
            button.closest("tr").remove();
        }
    </script>
}
